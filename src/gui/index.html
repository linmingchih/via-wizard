<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Via Wizard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="placement_styles.css">
</head>

<body>

    <!-- Menu Bar -->
    <div id="menu-bar">
        <div class="menu-item">
            File
            <div class="dropdown">
                <div class="dropdown-item" onclick="loadProject()">Load Project</div>
                <div class="dropdown-item" onclick="saveProject()">Save Project</div>
                <div class="dropdown-item" onclick="createNewStackup()">New Stackup</div>
                <div class="dropdown-item" onclick="openFile()">Load Stackup XML</div>
                <div class="dropdown-item" onclick="exitApp()">Exit</div>
            </div>
        </div>
        <div class="menu-item">
            Option
            <div class="dropdown">
                <div class="dropdown-item" onclick="toggleMessageWindow()">Hide/Show Message Window</div>
            </div>
        </div>
        <div class="menu-item">
            Help
            <div class="dropdown">
                <div class="dropdown-item" onclick="addMessage('Via Wizard v1.1.1')">About</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Tabs Header -->
        <div id="tabs-header">
            <button class="tab-btn active" onclick="openTab('tab-stackup')">Stackup</button>
            <button class="tab-btn" onclick="openTab('tab-padstack')">Padstack</button>
            <button class="tab-btn" onclick="openTab('tab-placement')">Placement</button>
            <button class="tab-btn" onclick="openTab('tab-simulation')">Simulation</button>
        </div>

        <!-- Tabs Content -->
        <div id="tabs-content">
            <!-- Tab 1: Stackup -->
            <div id="tab-stackup" class="tab-pane active">
                <div class="stackup-container">
                    <!-- Left Panel: Controls & Table -->
                    <div class="stackup-left">
                        <div class="stackup-controls">
                            <div class="control-group">
                                <label>Units:</label>
                                <input type="radio" name="units" value="mm" checked onchange="toggleUnits('mm')"> mm
                                <input type="radio" name="units" value="mil" onchange="toggleUnits('mil')"> mil
                            </div>
                        </div>

                        <div class="table-container" onpaste="handlePaste(event)">
                            <table id="stackup-table">
                                <thead>
                                    <tr>
                                        <th>Layer Name</th>
                                        <th>Type</th>
                                        <th>Thickness</th>
                                        <th>Dk</th>
                                        <th>Df</th>
                                        <th>Cond.</th>
                                        <th>IsRef</th>
                                        <th>DogBone(mil)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <p class="hint">Tip: Paste Excel data directly into the table.</p>
                    </div>

                    <!-- Right Panel: 2D Visualization -->
                    <div class="stackup-right">
                        <h3>2D Preview</h3>
                        <div id="stackup-visualizer">
                            <!-- SVG/Canvas will be injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Padstack -->
            <div id="tab-padstack" class="tab-pane">
                <div id="padstack-warning" class="hidden" style="padding: 20px; color: #ccc; text-align: center;">
                    <h3>No Stackup Loaded</h3>
                    <p>Please create or load a stackup in the Stackup tab to define padstacks.</p>
                </div>
                <div id="padstack-content" class="padstack-container">
                    <!-- Left Panel: Padstack List -->
                    <div class="padstack-sidebar">
                        <div class="sidebar-header">
                            <h3>Padstacks</h3>
                            <div class="sidebar-actions">
                                <button onclick="addPadstack()" title="Add Padstack">+</button>
                                <button onclick="deletePadstack()" title="Delete Padstack">-</button>
                            </div>
                        </div>
                        <ul id="padstack-list">
                            <!-- List items injected by JS -->
                        </ul>
                    </div>

                    <!-- Middle Panel: General Properties -->
                    <div class="padstack-main">
                        <div class="config-section">
                            <h4>General Properties</h4>

                            <!-- Row 1: Name & Hole Diameter -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Name:</label>
                                    <input type="text" id="pad-name"
                                        onchange="updatePadstackProperty('name', this.value)">
                                </div>
                                <div class="form-group">
                                    <label>Hole Diameter (mil):</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="pad-hole-diam" value="10"
                                            onchange="updatePadstackProperty('holeDiameter', this.value)">
                                    </div>
                                </div>
                            </div>

                            <!-- Row 2: Pad Size & Antipad Size -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Pad Size (mil):</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="pad-size" value="18"
                                            onchange="updatePadstackProperty('padSize', this.value)">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Antipad Size (mil):</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="pad-antipad-size" value="28"
                                            onchange="updatePadstackProperty('antipadSize', this.value)">
                                    </div>
                                </div>
                            </div>

                            <!-- Row 3: Material & Plating -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Material:</label>
                                    <select id="pad-material" onchange="updatePadstackProperty('material', this.value)">
                                        <option value="Copper" selected>Copper</option>
                                        <option value="Gold">Gold</option>
                                        <option value="Aluminum">Aluminum</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Plating %:</label>
                                    <input type="number" id="pad-plating" value="100"
                                        onchange="updatePadstackProperty('plating', this.value)">
                                </div>
                            </div>

                            <!-- Row 4: Start Layer & Stop Layer -->
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Start Layer:</label>
                                    <select id="pad-start-layer"
                                        onchange="updatePadstackProperty('startLayer', this.value)"></select>
                                </div>
                                <div class="form-group">
                                    <label>Stop Layer:</label>
                                    <select id="pad-stop-layer"
                                        onchange="updatePadstackProperty('stopLayer', this.value)"></select>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Right Panel: Backdrill -->
                    <div class="padstack-right">
                        <div class="config-section">
                            <h4>Backdrill Settings</h4>

                            <div class="form-group"
                                style="margin-top: 10px; border-top: 1px solid #444; padding-top: 10px;">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="pad-backdrill-en"
                                        onchange="toggleBackdrill(this.checked)">
                                    <label for="pad-backdrill-en">Enable Backdrill</label>
                                </div>
                            </div>

                            <div id="backdrill-inline-config" class="disabled">
                                <div class="form-group">
                                    <label>Drill Diameter (mil):</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="bd-diameter"
                                            onchange="updateBackdrillProperty('diameter', this.value)">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Mode:</label>
                                    <div class="radio-group">
                                        <input type="radio" name="bd-mode" value="layer" checked
                                            onchange="toggleBdMode(this.value)"> By Layer

                                    </div>
                                </div>

                                <div id="bd-mode-layer-group">
                                    <div class="form-group">
                                        <label>To Layer:</label>
                                        <select id="bd-to-layer"
                                            onchange="updateBackdrillProperty('toLayer', this.value)"></select>
                                    </div>
                                    <div class="form-group">
                                        <label>Stub Length (mil):</label>
                                        <input type="number" id="bd-stub"
                                            onchange="updateBackdrillProperty('stub', this.value)">
                                    </div>
                                </div>

                                <div id="bd-mode-depth-group" class="hidden">
                                    <div class="form-group">
                                        <label>Drill Depth:</label>
                                        <input type="number" id="bd-depth"
                                            onchange="updateBackdrillProperty('depth', this.value)">
                                    </div>
                                </div>

                                <div id="fill-group">
                                    <div class="form-group">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="fill" onchange="toggleFill(this.checked)">
                                            <label for="fill">Fill</label>
                                        </div>
                                    </div>
                                    <div id="fill-properties" class="form-grid">
                                        <div class="form-group">
                                            <label>DK:</label>
                                            <input type="number" id="fill-dk" style="width: 100px;"
                                                onchange="updateFillProperty('dk', this.value)">
                                        </div>
                                        <div class="form-group">
                                            <label>DF:</label>
                                            <input type="number" id="fill-df" style="width: 100px;"
                                                onchange="updateFillProperty('df', this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Placement -->
            <div id="tab-placement" class="tab-pane">
                <div class="placement-container">
                    <!-- Left Panel: Controls -->
                    <div class="placement-left">
                        <h3>Placement Controls</h3>
                        <div class="config-section">
                            <h4>Placement Type</h4>
                            <div class="radio-group-vertical">
                                <label><input type="radio" name="place-type" value="single" checked
                                        onchange="updatePlacementMode()"> Single Via</label>
                                <label><input type="radio" name="place-type" value="differential"
                                        onchange="updatePlacementMode()"> Differential Pair</label>
                                <label><input type="radio" name="place-type" value="diff_gnd"
                                        onchange="updatePlacementMode()"> Diff Pair w/ GND</label>
                                <label><input type="radio" name="place-type" value="gnd"
                                        onchange="updatePlacementMode()">
                                    GND Via</label>
                            </div>
                        </div>

                        <div class="config-section">
                            <h4>Padstack Selection</h4>
                            <select id="placement-padstack-select" class="full-width-select"></select>
                        </div>

                    </div>

                    <!-- Center Panel: Canvas -->
                    <div class="placement-center">
                        <div class="canvas-toolbar">
                            <div class="toolbar-group">
                                <button onclick="fitCanvas()">Fit All</button>

                                <label style="margin-left: 10px;">W:</label>
                                <input type="number" id="canvas-width" value="400" style="width: 40px;">
                                <label>H:</label>
                                <input type="number" id="canvas-height" value="200" style="width: 40px;">
                            </div>
                            <div class="toolbar-group">
                                <label>Grid:</label>
                                <input type="number" id="grid-spacing" value="5" style="width: 50px;"
                                    onchange="updateGrid()">
                                <span>mil</span>
                            </div>
                        </div>
                        <div id="canvas-wrapper" class="canvas-wrapper">
                            <canvas id="placement-canvas"></canvas>
                        </div>
                    </div>

                    <!-- Right Panel: Properties -->
                    <div class="placement-right">
                        <div class="placed-instances-section">
                            <h3>Placed Instances</h3>
                            <ul id="placed-list">
                                <!-- List of placed vias -->
                            </ul>
                        </div>
                        <div class="instance-properties-section">
                            <h3>Properties</h3>
                            <div id="prop-panel-content">
                                <p class="hint">Select an instance to view properties.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Simulation -->
            <div id="tab-simulation" class="tab-pane">
                <div class="simulation-container" style="display: flex; height: 100%;">
                    <!-- Left Panel: Controls -->
                    <div class="simulation-left"
                        style="width: 250px; background-color: #252526; padding: 10px; border-right: 1px solid #3e3e42; display: flex; flex-direction: column; gap: 15px;">
                        <h3>Simulation Controls</h3>

                        <div class="config-section">
                            <h4>Export Settings</h4>
                            <div class="form-group">
                                <label>AEDB Version:</label>
                                <input type="text" id="aedb-version" value="2024.1" style="width: 90%;">
                            </div>
                            <div class="form-group" style="margin-top: 15px;">
                                <button onclick="exportAEDB()"
                                    style="width: 100%; padding: 8px; background-color: #0e639c; color: white; border: none; cursor: pointer;">Export
                                    to AEDB</button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Content (Placeholder for now) -->
                    <div class="simulation-right" style="flex-grow: 1; padding: 20px;">
                        <h2>Simulation Configuration</h2>
                        <p>Configure simulation parameters and export to AEDB.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Window -->
    <div id="message-window" class="hidden">
        <div id="message-header">
            <span>Messages</span>
            <div>
                <button onclick="copyMessages()" style="font-size: 10px; padding: 2px 5px;">Copy</button>
                <button onclick="clearMessages()" style="font-size: 10px; padding: 2px 5px;">Clear</button>
                <button onclick="toggleMessageWindow()" style="font-size: 10px; padding: 2px 5px;">Close</button>
            </div>
        </div>
        <div id="message-body">
            <!-- Logs go here -->
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>

</html>